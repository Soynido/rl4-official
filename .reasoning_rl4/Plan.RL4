---
version: 3.5
updated: '2025-11-17T19:45:00.000Z'
confidence: 1.0
deviation_mode: exploratory
current_phase: "Sprint P0-CORE: Production Kernel"
sprint_started_on: '2025-11-17T19:45:00.000Z'
active_sprint: "P0-CORE"
next_phase_ready: null
---

# Plan â€” Strategic Vision

## Phase
âœ… E3.4 - COMPLETED | âœ… E4 - COMPLETED | âœ… E4.1 - Memory Safety (COMPLETED) | âœ… P0-HARDENING (COMPLETED) | âœ… P1-INTEGRITY (COMPLETED) | ğŸ¯ P0-CORE - Production Kernel (ACTIVE)

## Goal (E4 - COMPLETED âœ…)
**OBJECTIF ATTEINT** â€” Production MVP prÃªt :
1. âœ… **Parse LLM Response automatique** (clipboard â†’ proposals.json, 4 formats supportÃ©s)
2. âœ… **Helper scripts Terminal** (rl4-log.js + rl4-log.sh + README complet)
3. âœ… **Documentation complÃ¨te** (README.md + RELEASE_NOTES_v3.5.8.md)
4. âœ… **Release v3.5.8 ready** (toutes fonctionnalitÃ©s backend implÃ©mentÃ©es)

## Goal (E4.1 - Memory Safety Sprint) âœ… COMPLETED
**OBJECTIF ATTEINT** â€” Fuites mÃ©moire corrigÃ©es

### ProblÃ¨me RÃ‰SOLU
ğŸš¨ **Extension-host:** 770 MB aprÃ¨s 1h30 â†’ 164 GB aprÃ¨s 2 mois (crash certain)
ğŸš¨ **Renderer:** 1,18 GB aprÃ¨s 1h30 â†’ 252 GB aprÃ¨s 2 mois (crash certain)
ğŸš¨ **Root causes:** Event listeners jamais nettoyÃ©s + ExecPool buffers + Console.log accumulation

### Solution: 5 Phases (3h) â€” COMPLÃ‰TÃ‰ES
1. **Phase 0: Memory Monitoring** (15min) âœ…
   - CrÃ©er MemoryMonitor.ts (baseline + snapshots)
   - Logs toutes les 5 min + alerte si > 500 MB

2. **Phase 1: Disposables VS Code** (45min) â€” CRITIQUE âœ…
   - Nettoyer event listeners dans IDEActivityListener, BuildMetricsListener
   - Stocker disposables + dispose() propre
   - Gain: -60% croissance extension-host

3. **Phase 2: ExecPool Buffer Management** (45min) â€” CRITIQUE âœ…
   - Limiter buffers stdout/stderr Ã  1 KB
   - Rotation git_pool.jsonl aprÃ¨s 5000 lignes
   - Gain: -40% croissance extension-host

4. **Phase 3: Console.log Production Mode** (30min) âœ…
   - Logger webview avec rotation (max 100 logs)
   - DÃ©sactiver console.log en production
   - Gain: -70% croissance renderer

5. **Phase 4: JSONL Rotation** (30min) âœ…
   - Rotation automatique aprÃ¨s 10K lignes
   - Compression archives .gz
   - Maintient fichiers actifs < 10K lignes

**âœ… RÃ©sultats:** -97% RAM projetÃ© (770 MB â†’ 200 MB aprÃ¨s 1h30)  
**âœ… Extension version:** v3.5.11 active depuis 2025-11-17T13:42  
**âœ… Sprint complÃ©tÃ©:** 2025-11-17T14:50

## Goal (P0-CORE - Production Kernel) ğŸ¯ ACTIVE
**OBJECTIF: Rendre le kernel RL4 production-ready avec diagnostic complet**

### ProblÃ¨me IdentifiÃ©
ğŸ”´ **Cognitive Loop Inerte:** 721 cycles exÃ©cutÃ©s avec count: 0 pour toutes les phases â†’ kernel tourne Ã  vide
ğŸ”´ **Kernel Status Invisible:** Utilisateur ne peut pas diagnostiquer l'Ã©tat du kernel (SAFE MODE, cycles, phases)
ğŸŸ¡ **Artifacts Manquants:** state.json.gz, universals.json.gz jamais gÃ©nÃ©rÃ©s â†’ recalibration LLM impossible
ğŸŸ¢ **StabilitÃ© ConfirmÃ©e:** RAM stable (133 MB aprÃ¨s 14h), ledger intact, patches P0/P1 appliquÃ©s

**âœ… DIAGNOSTIQUÃ‰:** Analyse complÃ¨te effectuÃ©e (2025-11-17T19:30)

### Solution: 7 TÃ¢ches Critiques (12-14h estimÃ©)
1. **P0-CORE-00: Fix Cognitive Loop Inertia** (2-4h) ğŸ”´ CRITIQUE
   - Diagnostic pourquoi PatternLearning, Correlation, Forecast, ADR retournent []
   - RÃ©parer les 4 engines pour qu'ils produisent des rÃ©sultats
   
2. **P0-CORE-03: WebView Bridge v1** (2h) ğŸ”´ CRITIQUE
   - ImplÃ©menter rl4:getStatus â†’ KernelStatus â†’ rl4:status
   - Afficher statut kernel dans Control Tab
   
3. **P0-CORE-02: Kernel Ready Protocol** (1.5h) ğŸ”´ HIGH
   - ImplÃ©menter kernel.init(), loadArtifacts(), verifyLedger(), ready flag
   - Bloquer WebView jusqu'Ã  kernel.ready
   
4. **P0-CORE-01: Kernel Artifact Engine** (2h) ğŸŸ¡ P1
   - GÃ©nÃ©rer state.json.gz, universals.json.gz, cognitive_history.json.gz
   - writeAtomic() avec checksum, loadWithRetry()
   
5. **P0-CORE-06: Kernel Sovereignty Mode** (1.5h) ğŸŸ¡ P1
   - Ã‰mettre kernel:not-ready si appelÃ© trop tÃ´t
   - Auto-restart WebView quand kernel ready
   
6. **P0-CORE-05: Production Scheduler** (2h) ğŸŸ¡ P1
   - Adaptive intervals (10s â†’ 15s â†’ 2min â†’ 10min)
   - Burst mode + cooldown si memory > 450 MB
   
7. **P0-CORE-04: Cognitive Loop Full Mode** (identique Ã  CORE-00)

## Goal (P0-HARDENING - Production Stability) âœ… COMPLETED
**OBJECTIF ATTEINT** â€” Kernel durci contre deadlocks et corruption

### Sprints ComplÃ©tÃ©s
1. **P0-HARDENING-01:** isRunning reset garanti (CognitiveScheduler.ts)
2. **P0-HARDENING-02:** Eager Merkle cache load (RBOMLedger.ts)
3. **P0-HARDENING-03:** Production config defaults (config.ts)

**âœ… Sprint complÃ©tÃ©:** 2025-11-17T15:40

## Goal (P1-INTEGRITY - Ledger Hardening) âœ… COMPLETED
**OBJECTIF ATTEINT** â€” IntÃ©gritÃ© ledger garantie

### Sprints ComplÃ©tÃ©s
1. **P1-INTEGRITY-01:** FALSE POSITIVE (pas de circular Merkle bug) â€” ADR-016
2. **P1-INTEGRITY-02 PATCH 2:** Flush-before-cache-update avec retry logic
3. **P1-INTEGRITY-02 PATCH 5:** validateLastLine() dans AppendOnlyWriter
4. **P1-INTEGRITY-02 PATCH 6:** SAFE MODE avec startup verification

**âœ… Sprint complÃ©tÃ©:** 2025-11-17T16:30

## Goal (E5 - Pattern Learning UI) ğŸ¯ PAUSED
**OBJECTIF: Exposer Pattern Learning dans l'UI**

### ProblÃ¨me
âœ… **Backend Ready:** TerminalPatternsLearner (476 lignes) fonctionne et apprend
âŒ **UI Missing:** Utilisateur ne voit JAMAIS les patterns appris ni les suggestions

**â¸ï¸ PAUSED:** PrioritÃ© donnÃ©e Ã  P0-CORE (kernel production-ready d'abord)

## Timeline
**Phase E3.4:**
- Start: 2025-11-16 00:00:00
- Completed: 2025-11-16 06:45:00
- Duration: 6h 45min âœ…

**Phase E4:**
- Start: 2025-11-16 07:00:00
- Completed: 2025-11-16 08:00:00
- Duration: 1h âœ… (ultra-rapide, backend dÃ©jÃ  prÃªt)

**Phase E5 (Current):**
- Start: 2025-11-16 08:00:00
- Target: 2025-11-16 14:00:00
- Duration: 6h (estimated)

## Success Criteria E4 (ALL âœ…)

### ğŸ”´ P0 (Must Have) â€” COMPLETED
- [x] Parse LLM Response command implemented (`parseLLMResponse` handler) âœ…
- [x] Button "Parse LLM Response" in Control Tab UI âœ…
- [x] Clipboard â†’ proposals.json workflow validated âœ…

### ğŸŸ¡ P1 (Should Have) â€” COMPLETED
- [x] Helper scripts: `rl4-log.js` (Node.js) created âœ…
- [x] Helper scripts: `rl4-log.sh` (Bash) created âœ…
- [x] README_RL4_TERMINAL.md documentation written âœ…
- [x] README.md updated with Phase E3.4 achievements âœ…

### ğŸŸ¢ P2 (Nice to Have) â€” COMPLETED
- [x] Release notes v3.5.8 drafted âœ…
- [ ] E2E workflow test in test workspace (manual testing)
- [ ] ADR-011: Terminal Patterns Learning Strategy (optional)

## Success Criteria E5 (NEW)

### ğŸ”´ P0 (Must Have)
- [ ] Onglet "Patterns" dans Insights Tab avec affichage terminal-patterns.json
- [ ] PatternsCard component (table + dÃ©tails par pattern)
- [ ] Section Anomalies avec success rate drops + unusual durations
- [ ] DÃ©tection tÃ¢ches sans `@rl4:completeWhen` + suggestions
- [ ] UI "Suggested Conditions" dans Dev Tab
- [ ] Handler `applySuggestion` pour apply auto-suggestions

### ğŸŸ¡ P1 (Should Have)
- [ ] AdHocTracker.ts component pour tracking actions non planifiÃ©es
- [ ] Support marqueur `# RL4_ACTION` dans helper scripts
- [ ] Enrichissement snapshot avec ad-hoc actions
- [ ] UI "Suggested from Activity" dans Dev Tab

### ğŸŸ¢ P2 (Nice to Have)
- [ ] Duration histogram (visual charts)
- [ ] Command classification badges (color-coded)
- [ ] Pattern comparison tool (before/after)

## Production-Ready Mode (P0 Core)

**Status:** planned
**Priority:** P0 (post-E4.1 Memory Safety)
**Estimated Effort:** 6h
**Scope:** Minimal (analyzer + snapshot + recommendations only)

### Goal
Introduire un systÃ¨me de validation production-ready permettant d'analyser l'Ã©tat du RL4 et de gÃ©nÃ©rer un score de robustesse avant release.

**Scope P0 (Minimal):**
- ProductionReadyAnalyzer (analyse kernel + JSONL + timers)
- ProductionReadySnapshotBuilder (gÃ©nÃ¨re snapshot texte + score)
- HardeningEngine minimal (recommandations uniquement, pas d'exÃ©cution)
- Commande VS Code + Bouton UI dans Control Tab existant
- JSONL log production-checks.jsonl (historique scores)

### Components P0

1. **ProductionReadyAnalyzer.ts** (2h)
   - Analyse: HealthMonitor, MemoryMonitor, CognitiveScheduler, JSONL files, timers/watchers
   - Calcul score 0-100% basÃ© sur thresholds
   - Retourne ProductionReadinessReport

2. **ProductionReadySnapshotBuilder.ts** (2h)
   - GÃ©nÃ¨re snapshot Markdown: Score + Issues + Metrics + Recommendations
   - Copie automatique clipboard
   - Appelle ProductionReadyAnalyzer

3. **HardeningEngine.ts** (1h - minimal)
   - DÃ©tecte issues: memory, JSONL size, timers count
   - GÃ©nÃ¨re recommandations texte (pas d'exÃ©cution)

4. **Commande + UI** (1h)
   - Commande: reasoning.snapshot.productionReady
   - Bouton "Production Check" dans Control Tab
   - Notification avec score
   - Log: production-checks.jsonl

### Success Criteria P0

- âœ… Score readiness calculÃ© (0-100%)
- âœ… Issues critiques dÃ©tectÃ©es
- âœ… Recommandations gÃ©nÃ©rÃ©es
- âœ… Commande + bouton UI fonctionnels
- âœ… Historique dans production-checks.jsonl

### Risks

- ğŸŸ¡ Bias 35% (threshold exploratory 50%) âœ…
- ğŸŸ¢ DÃ©pendance E4.1 (blocker: E4.1 DOIT Ãªtre complÃ©tÃ© AVANT)
- ğŸŸ¢ Scoring v1 simple (amÃ©lioration P1)

### Dependencies

**Hard:** E4.1 Memory Safety âœ… COMPLÃ‰TÃ‰ (2025-11-17T14:50)
**Soft:** E5 Pattern Learning (parallÃ¨le possible)

### Timeline

**Post-E4.1:** 6h (4 fichiers crÃ©Ã©s, 3 modifiÃ©s)
**Bias:** 35% (sous threshold 50% exploratory)

### Next Phase (P1 - Sprints Futurs)

- P1.1: UI avancÃ©e (onglet Production + gauge) - 3h
- P1.2: HardeningExecutor (apply recommendations) - 2h
- P1.3: Advanced analysis (MemoryLeakDetector + PerformanceProfiler) - 2h
- P1.4: Automation (AutoHardeningScheduler) - 1h
- P1.5: Documentation (ADR-012 + RL4_ProductionReady.mdc) - 1h

## Success Criteria E3.4 (ALL âœ…)
- âœ… PromptOptimizer.ts avec 4 modes compression (strict/flexible/exploratory/free)
- âœ… AnomalyDetector.ts avec dÃ©tection 5 types (sudden_change, regression, unusual_activity, bias_spike, plan_drift)
- âœ… UnifiedPromptBuilder.ts retourne { prompt, metadata: { anomalies, compression } }
- âœ… SnapshotReminder avec timer 30min + auto-suggest mode
- âœ… Terminal RL4 command avec AppendOnlyWriter vers terminal-events.jsonl
- âœ… Workflow LLM proposals: proposals.json â†’ submitDecisions â†’ applyPatch
- âœ… WebView 4 tabs (Control/Dev/Insights/About) avec gestion anomalies + compression metrics
- âœ… TasksRL4Parser pour extraire @rl4:id / @rl4:completeWhen
- âœ… TaskVerificationEngine avec vÃ©rification pÃ©riodique 10s + confidence calculation
- âœ… Dev Tab UI "Verified by RL4" avec badges + "Mark as Done"
- âœ… TerminalPatternsLearner avec auto-learning + suggest completeWhen + detect anomalies
- âœ… Extension compilÃ©e (717 KiB) + webview (307.85 KiB)

## Architecture Dev Tab (Ã‰tat Final)

### **Workflow Complet**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. User gÃ©nÃ¨re snapshot (Exploratory/Free mode)                â”‚
â”‚ 2. LLM retourne propositions avec RL4_PROPOSAL {...}           â”‚
â”‚ 3. User: "Parse LLM Response" â†’ clipboard lu automatiquement   â”‚
â”‚ 4. RL4: Parse JSON â†’ Ã‰crit proposals.json                      â”‚
â”‚ 5. Badge Dev Tab: "3 nouvelles propositions"                   â”‚
â”‚ 6. User ouvre Dev Tab â†’ Voit 3 propositions                    â”‚
â”‚ 7. User accepte 2 (P0), rejette 1                              â”‚
â”‚ 8. Patch preview gÃ©nÃ©rÃ© (bias check: 15% < 25% âœ…)             â”‚
â”‚ 9. User valide â†’ 2 tÃ¢ches ajoutÃ©es Ã  Tasks.RL4                â”‚
â”‚    Format: - [ ] [P0] Task title @rl4:id=task-001              â”‚
â”‚ 10. User exÃ©cute dans RL4 Terminal:                            â”‚
â”‚     echo '# RL4_TASK_START id=task-001 command="npm test"'     â”‚
â”‚     npm test                                                    â”‚
â”‚     echo '# RL4_TASK_RESULT id=task-001 status=success'        â”‚
â”‚ 11. RL4: DÃ©tecte terminal-events.jsonl â†’ Matche @rl4:id        â”‚
â”‚ 12. Dev Tab: Badge "âœ… Verified by RL4" apparaÃ®t sur la tÃ¢che  â”‚
â”‚ 13. Prochain snapshot: TÃ¢che marquÃ©e comme complÃ©tÃ©e           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Composants Ã  ImplÃ©menter**

#### **1. LLM Response Parser (extension.ts)**
```typescript
case 'parseLLMResponse':
  // Lit clipboard
  const clipboardText = await vscode.env.clipboard.readText();
  
  // Cherche RL4_PROPOSAL (supporte JSON fenced ou raw)
  const match = clipboardText.match(/RL4_PROPOSAL["\s:]*({[\s\S]*?})/);
  if (match) {
    const proposals = JSON.parse(match[1]);
    fs.writeFileSync(proposalsPath, JSON.stringify(proposals, null, 2));
    webviewPanel.postMessage({ type: 'proposalsParsed', count: proposals.suggestedTasks.length });
  }
```

#### **2. Terminal Helper Scripts**
- **scripts/rl4-log.js** : Helper Node.js pour Ã©crire dans terminal-events.jsonl
- **scripts/rl4-log.sh** : Helper Bash pour marqueurs RL4_TASK_*

#### **3. TaskVerificationEngine (kernel/api/TaskVerificationEngine.ts)**
```typescript
class TaskVerificationEngine {
  // Lit terminal-events.jsonl
  loadTerminalEvents(since?: Date): TerminalEvent[]
  
  // Lit Tasks.RL4 et extrait @rl4:id / @rl4:completeWhen
  parseTaskMetadata(tasksFile: string): TaskMetadata[]
  
  // Matche events avec tÃ¢ches
  verifyTasks(tasks, events): TaskVerification[]
  
  // Retourne { taskId, verified: boolean, lastEvent, duration }
}
```

#### **4. Extended Tasks.RL4 Parser**
Support nouveau format :
```markdown
- [ ] [P0] Add unit tests @rl4:id=task-001 @rl4:completeWhen="exitCode=0"
```

#### **5. Dev Tab UI Enhancement**
Affichage enrichi :
```tsx
{item.verified && (
  <span style={{ color: '#4caf50', fontSize: '10px' }}>
    âœ… Verified by RL4 ({item.verifiedAt})
  </span>
)}
```

## Vision Long-Term

Transformer RL4 en systÃ¨me auto-apprenant oÃ¹ :
- **Prompts enrichissent les logs** (via marqueurs RL4_TASK_*)
- **Kernel sniffe les fichiers** (pas d'API VS Code)
- **Patterns Ã©mergent** (terminal-patterns.json)
- **VÃ©rification automatique** (Dev Tab temps rÃ©el)
- **Feedback loop complet** (LLM â†’ Tasks â†’ Terminal â†’ Logs â†’ Verification â†’ Snapshot)

## Architecture Globale (Rappel)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CONTROL TAB                             â”‚
â”‚  - Generate Snapshot (deviation modes)                     â”‚
â”‚  - GitHub Integration                                       â”‚
â”‚  - Commit with WHY                                          â”‚
â”‚  - Parse LLM Response ğŸ†•                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DEV TAB                                â”‚
â”‚  - Proposed Tasks (from proposals.json)                    â”‚
â”‚  - Accept/Reject buttons                                   â”‚
â”‚  - Patch Preview                                            â”‚
â”‚  - Apply Patch â†’ Tasks.RL4                                  â”‚
â”‚  - Task Status: "âœ… Verified by RL4" ğŸ†•                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RL4 TERMINAL ğŸ†•                           â”‚
â”‚  - Terminal dÃ©diÃ© pour dev                                 â”‚
â”‚  - Marqueurs: # RL4_TASK_START / # RL4_TASK_RESULT         â”‚
â”‚  - Scripts helper: rl4-log.js / rl4-log.sh                 â”‚
â”‚  - Logs â†’ .reasoning_rl4/terminal-events.jsonl             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TASK VERIFICATION ENGINE ğŸ†•                    â”‚
â”‚  - Lit terminal-events.jsonl                               â”‚
â”‚  - Parse @rl4:id dans Tasks.RL4                            â”‚
â”‚  - Matche events avec tÃ¢ches                               â”‚
â”‚  - Retourne verified: true/false                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  INSIGHTS TAB                               â”‚
â”‚  - KPIs Dashboard                                           â”‚
â”‚  - Anomalies Card                                           â”‚
â”‚  - Task Completion Rate ğŸ†•                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## DÃ©pendances Techniques

- âœ… `proposals.json` watcher (dÃ©jÃ  implÃ©mentÃ©)
- âœ… `submitDecisions` handler (dÃ©jÃ  implÃ©mentÃ©)
- âœ… `applyPatch` handler (dÃ©jÃ  implÃ©mentÃ©)
- âœ… Bias Guard (dÃ©jÃ  implÃ©mentÃ©)
- âœ… Ledger logging (dÃ©jÃ  implÃ©mentÃ©)
- ğŸ†• `parseLLMResponse` handler (Ã  implÃ©menter)
- ğŸ†• `TaskVerificationEngine` (Ã  implÃ©menter)
- ğŸ†• Parser `@rl4:id` dans Tasks.RL4 (Ã  implÃ©menter)
- ğŸ†• Scripts helper terminal (Ã  implÃ©menter)
- ğŸ†• UI badge "Verified by RL4" (Ã  implÃ©menter)
- ğŸ†• **Auto-completion UI** (bouton "Mark as Done" quand verified)
- ğŸ†• **Ad-hoc tracker** (`ad-hoc-actions.jsonl` + UI proposals)
- ğŸ†• **Pattern learning** (`terminal-patterns.json` + suggestions)

## Auto-Completion Workflow ğŸš€

### Principe
**RL4 ne modifie JAMAIS Tasks.RL4 automatiquement**. Il propose uniquement.

### Workflow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Task dans Tasks.RL4:                                    â”‚
â”‚    - [ ] [P0] All tests passing @rl4:id=task-001           â”‚
â”‚                 @rl4:completeWhen="npm test exitCode=0"    â”‚
â”‚                                                             â”‚
â”‚ 2. User exÃ©cute dans RL4 Terminal:                         â”‚
â”‚    echo '# RL4_TASK_START id=task-001 command="npm test"'  â”‚
â”‚    npm test                                                 â”‚
â”‚    echo '# RL4_TASK_RESULT id=task-001 status=success      â”‚
â”‚          exitCode=0'                                        â”‚
â”‚                                                             â”‚
â”‚ 3. TaskVerificationEngine:                                 â”‚
â”‚    - Lit terminal-events.jsonl                             â”‚
â”‚    - Matche id=task-001                                    â”‚
â”‚    - VÃ©rifie: exitCode=0 && status=success âœ…              â”‚
â”‚    - Marque: verified=true (en mÃ©moire)                    â”‚
â”‚                                                             â”‚
â”‚ 4. Dev Tab affiche:                                        â”‚
â”‚    [P0] All tests passing                                  â”‚
â”‚    âœ… Verified by RL4 (2025-11-16T05:15:00Z)               â”‚
â”‚    [Mark as Done] â† Bouton apparaÃ®t                        â”‚
â”‚                                                             â”‚
â”‚ 5. User clique "Mark as Done":                             â”‚
â”‚    - extension.ts reÃ§oit { type: 'markTaskDone',           â”‚
â”‚                             taskId: 'task-001' }           â”‚
â”‚    - Lit Tasks.RL4                                         â”‚
â”‚    - Remplace:                                             â”‚
â”‚      - [ ] [P0] All tests passing...                       â”‚
â”‚      + [x] [P0] All tests passing (verified 2025-11-16)    â”‚
â”‚    - Log dans decisions.jsonl:                             â”‚
â”‚      { event: 'task_completed', taskId: 'task-001',        â”‚
â”‚        trigger: 'terminal', verified: true }               â”‚
â”‚                                                             â”‚
â”‚ 6. Prochain snapshot:                                      â”‚
â”‚    LLM voit tÃ¢che cochÃ©e + timestamp vÃ©rification          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RÃ¨gle Stricte
- âŒ **Jamais d'auto-mark** sans validation user
- âœ… **Toujours proposer** "Mark as Done" quand verified
- âœ… **Toujours logger** dans decisions.jsonl avec source (terminal/manual)

## Ad-Hoc Actions Workflow ğŸ”§

### ProblÃ¨me
User demande: "Refactor cette fonction vite fait" â†’ Pas dans Tasks.RL4

### Solution
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. LLM (moi) dÃ©tecte: action non liÃ©e Ã  Tasks.RL4          â”‚
â”‚                                                             â”‚
â”‚ 2. Dans RL4 Terminal, j'ajoute marqueur:                   â”‚
â”‚    echo '# RL4_ACTION adhoc=true description="Refactor     â”‚
â”‚           UserService.getProfile" files="UserService.ts"'  â”‚
â”‚    (refactor code...)                                       â”‚
â”‚    echo '# RL4_ACTION_RESULT adhoc-001 status=success'     â”‚
â”‚                                                             â”‚
â”‚ 3. Kernel Ã©crit dans ad-hoc-actions.jsonl:                 â”‚
â”‚    { type: 'adhoc', id: 'adhoc-001', timestamp: '...',     â”‚
â”‚      description: 'Refactor UserService.getProfile',       â”‚
â”‚      files: ['UserService.ts'], status: 'success' }        â”‚
â”‚                                                             â”‚
â”‚ 4. Au prochain snapshot:                                   â”‚
â”‚    Prompt inclut section "Ad-hoc actions (last 24h)":      â”‚
â”‚    - Refactor UserService.getProfile (adhoc-001)           â”‚
â”‚    - Fix typo in README (adhoc-002)                        â”‚
â”‚                                                             â”‚
â”‚ 5. LLM analyse et peut proposer dans RL4_PROPOSAL:         â”‚
â”‚    { id: 'from-adhoc-001', title: 'Document refactored     â”‚
â”‚      UserService', why: 'Refactored but no doc', ... }     â”‚
â”‚                                                             â”‚
â”‚ 6. User voit proposition dans Dev Tab:                     â”‚
â”‚    ğŸ’¡ Suggested from activity:                             â”‚
â”‚    "Document refactored UserService"                       â”‚
â”‚    [Accept P1] [Backlog] [Ignore]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### BÃ©nÃ©fices
- âœ… Aucune incohÃ©rence (ad-hoc â‰  tasks officielles)
- âœ… TraÃ§abilitÃ© complÃ¨te (toutes actions loggÃ©es)
- âœ… Feedback loop (ad-hoc â†’ proposals â†’ tasks)
- âœ… Pas de pollution Tasks.RL4 (seulement si user accepte)

## Terminal Patterns Learning ğŸ§ 

### Objectif
RL4 apprend, par workspace, quelles commandes valident quelles tÃ¢ches.

### MÃ©canisme
```json
// .reasoning_rl4/terminal-patterns.json
{
  "learned_at": "2025-11-16T05:00:00.000Z",
  "workspace_id": "rl4-official",
  "patterns": {
    "task-001": {
      "taskTitle": "All tests passing",
      "typicalCommands": ["npm test", "npm run test:unit"],
      "successRate": 0.95,
      "avgDuration": 5200,
      "lastRun": "2025-11-16T05:15:00.000Z",
      "runsCount": 23
    },
    "task-002": {
      "taskTitle": "Build passes",
      "typicalCommands": ["npm run build", "webpack --config prod"],
      "successRate": 1.0,
      "avgDuration": 12000,
      "lastRun": "2025-11-16T04:30:00.000Z",
      "runsCount": 12
    }
  },
  "commandClassification": {
    "npm test": "Debug",
    "npm run dev": "Implementation",
    "npm run build": "Validation",
    "docker-compose up": "Setup"
  }
}
```

### Utilisation

#### 1. Auto-suggestion `@rl4:completeWhen`
Quand user ajoute nouvelle task sans `@rl4:completeWhen`:
```markdown
User ajoute: - [ ] [P0] E2E tests passing

RL4 suggÃ¨re (Dev Tab):
ğŸ’¡ This task looks like testing
   Suggested: @rl4:completeWhen="npm run test:e2e exitCode=0"
   (Based on learned pattern from task-001)
   [Apply] [Edit] [Ignore]
```

#### 2. Phase Classification AmÃ©liorÃ©e
Snapshot prompt enrichi:
```
Recent terminal activity (last 2h):
- npm test (15 runs, 93% success) â†’ Debug phase likely
- npm run dev (running continuously) â†’ Implementation active
- Last build: 45min ago

Learned patterns suggest: Current phase = Debug
```

#### 3. Anomaly Detection
```
âš ï¸ Unusual: 'npm test' failed 5 times in a row (usual success rate: 95%)
   Possible regression? Consider checking:
   - Recent commits (last 2h)
   - Dependencies changes
```

### Learning Process
1. **Capture**: Chaque commande terminal â†’ terminal-events.jsonl
2. **Aggregate**: Toutes les 30min, TaskVerificationEngine agrÃ¨ge:
   - Commandes par task-id
   - Success rates
   - DurÃ©es moyennes
3. **Update**: terminal-patterns.json mis Ã  jour
4. **Suggest**: Suggestions remontent dans Dev Tab
5. **Feedback**: User accepte/rejette â†’ Affine learning

### Privacy & Control
- âœ… 100% local (pas de cloud)
- âœ… Par workspace (pas de data cross-workspace)
- âœ… User peut reset: `rm .reasoning_rl4/terminal-patterns.json`
- âœ… Suggestions jamais forcÃ©es (toujours boutons Accept/Ignore)
