---
version: 3.6
updated: '2025-11-17T14:50:00.000Z'
bias: 30.61
---

# Tasks â€” Tactical TODOs

## Active (P0) â€” URGENT

### ğŸ”´ SPRINT P0-REPAIR: Full RL4 Repair & Re-Bootstrap (2h estimated)

**âš ï¸ SYSTEM CRITICAL:** Full kernel + ledger + RBOM repair required
**ğŸ¯ OBJECTIF:** Repartir sur une base 100% propre et opÃ©rationnelle

#### **Phase 0: Pre-Repair Diagnostics (15min)** ğŸ”´ CRITICAL
- [ ] [P0] Verify .reasoning_rl4 folder structure @rl4:id=P0-REPAIR-00-verify
  - Check for duplicate .reasoning_rl4 folders
  - List all submodules with .reasoning_rl4
  - Propose cleanup if duplicates found
  - Status: pending

- [ ] [P0] Diagnose ledger corruption @rl4:id=P0-REPAIR-00-ledger
  - Read adr-ledger.jsonl and validate JSON format
  - Check for invalid entries, sequential issues, missing signatures
  - Determine if genesis rebuild is required
  - Status: pending

- [ ] [P0] Diagnose kernel state @rl4:id=P0-REPAIR-00-kernel
  - Check if kernel/state.json exists and is valid
  - Check if kernel/manifest.json is coherent
  - Determine if full kernel reset is required
  - Status: pending

#### **Phase 1: Ledger Repair (30min)** ğŸ”´ CRITICAL
- [ ] [P0] Backup existing ledger @rl4:id=P0-REPAIR-01-backup
  - Copy adr-ledger.jsonl to adr-ledger.jsonl.backup
  - Timestamp: 2025-11-18T15:05:00Z
  - Status: pending

- [ ] [P0] Regenerate ledger genesis @rl4:id=P0-REPAIR-01-genesis
  - Create clean genesis entry in adr-ledger.jsonl
  - Format: { type: "genesis", timestamp, signature, merkleRoot }
  - Purge all invalid entries
  - Status: pending

#### **Phase 2: Kernel Repair (30min)** ğŸ”´ CRITICAL
- [ ] [P0] Reset kernel state @rl4:id=P0-REPAIR-02-state
  - Delete kernel/state.json if exists
  - Clear any stale state artifacts
  - Status: pending

- [ ] [P0] Regenerate kernel manifest @rl4:id=P0-REPAIR-02-manifest
  - Rebuild kernel/manifest.json from scratch
  - Include: version, timestamp, cycleCount, artifacts
  - Status: pending

- [ ] [P0] Rebuild cognitive index @rl4:id=P0-REPAIR-02-index
  - Scan extension/kernel/**/*.ts for cognitive modules
  - Generate index.json with module registry
  - Status: pending

#### **Phase 3: Traces & Config Cleanup (20min)** ğŸŸ¡ MEDIUM
- [ ] [P0] Purge incomplete traces @rl4:id=P0-REPAIR-03-traces
  - Check traces/ directory for coherence
  - Remove any incomplete or corrupted trace files
  - Create fresh traces/ structure
  - Status: pending

- [ ] [P0] Regenerate runtime config @rl4:id=P0-REPAIR-03-config
  - Recreate settings.json if incoherent
  - Disable any service worker references
  - Ensure WebView config is clean
  - Status: pending

#### **Phase 4: RBOM Revalidation (20min)** ğŸŸ¡ MEDIUM
- [ ] [P0] Recalculate RBOM hashes @rl4:id=P0-REPAIR-04-hashes
  - Scan all RBOM entries
  - Recalculate merkleRoot for each node
  - Verify chain continuity
  - Status: pending

- [ ] [P0] Regenerate RBOM metadata @rl4:id=P0-REPAIR-04-metadata
  - Update timestamps, signatures, versions
  - Ensure all metadata fields are valid
  - Status: pending

#### **Phase 5: Kernel Restart (15min)** ğŸ”´ CRITICAL
- [ ] [P0] Execute kernel boot sequence @rl4:id=P0-REPAIR-05-boot
  - Initialize TimerRegistry, StateRegistry, HealthMonitor
  - Bootstrap CognitiveScheduler
  - Verify kernel.isReady = true
  - Status: pending

- [ ] [P0] Bootstrap WebView @rl4:id=P0-REPAIR-05-webview
  - Recreate WebView panel
  - Ensure HTML/JS assets are loaded
  - Verify message bridge is active
  - Status: pending

- [ ] [P0] Reconnect ULTRA account @rl4:id=P0-REPAIR-05-ultra
  - Verify workspace signature
  - Reconnect to RL4 services if needed
  - Status: pending

#### **Phase 6: Validation Tests (15min)** ğŸŸ¢ LOW
- [ ] [P0] Verify kernel ready @rl4:id=P0-REPAIR-06-ready
  - Check kernel.isReady flag
  - Verify no SAFE MODE active
  - Confirm cycle execution < 10ms
  - Status: pending

- [ ] [P0] Deep verification (0 anomalies) @rl4:id=P0-REPAIR-06-deep
  - Run deepVerification() on ledger
  - Check RBOM chain integrity
  - Verify all artifacts are valid
  - Status: pending

- [ ] [P0] WebView interaction test @rl4:id=P0-REPAIR-06-ui
  - Open RL4 Dashboard
  - Verify all CTAs are clickable
  - Test snapshot generation workflow
  - Confirm 0 console errors
  - Status: pending

---

### ğŸ”´ SPRINT E4.1: Memory Safety â€” CRITICAL FIX (4h45min estimated)

**âš ï¸ BUG CRITIQUE:** Extension-host 770 MB + Renderer 1.2 GB â†’ Memory leaks
**âœ… PARTIAL FIX:** `retainContextWhenHidden: false` appliquÃ© (libÃ¨re ~1 GB renderer)
**ğŸ¯ OBJECTIF:** -97% RAM (770 MB â†’ 200 MB projection)

#### **Completed (1/14 tasks)**
- [x] [P0] Corriger retainContextWhenHidden dans extension.ts @rl4:id=fix-retain-context @rl4:verified="2025-11-16T16:10:00Z"
  - âœ… ChangÃ© `retainContextWhenHidden: true` â†’ `false` (2 occurrences)
  - âœ… Gain: -1 GB RAM quand dashboard fermÃ©
  - âœ… Fix workspace freeze

#### **Phase 0: Memory Monitoring (2h)** ğŸ”´ CRITICAL
- [x] [P0] CrÃ©er MemoryMonitor.ts @rl4:id=memory-monitor @rl4:verified="2025-11-17T13:10:00Z"
  - Classe MemoryMonitor avec mÃ©thodes: snapshot(), logIfHigh(threshold), getMetrics()
  - Fonction `snapshot()`: Retourne heapUsed, heapTotal, external, deltaFromBaseline
  - Fonction `logIfHigh(threshold)`: Alerte si RAM > threshold MB
  - Baseline au dÃ©marrage + snapshots pÃ©riodiques
  - Location: extension/kernel/MemoryMonitor.ts

- [x] [P0] IntÃ©grer MemoryMonitor dans extension.ts @rl4:id=memory-integration @rl4:verified="2025-11-17T13:10:00Z"
  - Instancier au dÃ©marrage extension
  - Log snapshots toutes les 5 min (setInterval)
  - Stocker dans context.subscriptions pour cleanup
  - Dependencies: MemoryMonitor.ts doit exister

#### **Phase 1: Disposables VS Code (45min)** ğŸ”´ CRITICAL
- [x] [P0] Corriger IDEActivityListener.ts @rl4:id=fix-ide-listener @rl4:verified="2025-11-17T13:15:00Z"
  - Ajouter field `private disposables: vscode.Disposable[] = []`
  - Stocker tous les `vscode.window.onDid*` listeners dans disposables array
  - MÃ©thode `dispose()`: Cleanup tous les disposables
  - Impact: -60% croissance extension-host (event listeners leak fix)

- [x] [P0] Corriger BuildMetricsListener.ts @rl4:id=fix-build-listener @rl4:verified="2025-11-17T13:20:00Z"
  - MÃªme pattern que IDEActivityListener
  - Stocker disposables + mÃ©thode dispose() propre
  - Impact: -60% croissance extension-host

- [x] [P0] Appeler dispose() dans deactivate() @rl4:id=call-dispose @rl4:verified="2025-11-17T13:25:00Z"
  - Ajouter appels dispose() dans extension.ts deactivate()
  - Ordre: Disposer listeners â†’ Disposer scheduler â†’ Shutdown kernel
  - Dependencies: fix-ide-listener et fix-build-listener doivent Ãªtre complÃ©tÃ©s

#### **Phase 2: ExecPool Buffer Management (45min)** ğŸ”´ CRITICAL
- [x] [P0] Limiter buffers dans ExecPool.ts @rl4:id=execpool-buffers @rl4:verified="2025-11-17T13:30:00Z"
  - Sanitize stdout/stderr Ã  1 KB max
  - Forcer libÃ©ration mÃ©moire: `result.stdout = ''` aprÃ¨s sanitize
  - Impact: -40% croissance extension-host (buffer accumulation fix)

- [x] [P0] Rotation git_pool.jsonl @rl4:id=rotate-git-pool @rl4:verified="2025-11-17T13:30:00Z"
  - Fonction `rotateLogIfNeeded()`: Rotation aprÃ¨s 5000 lignes
  - Renommer en `git_pool-{timestamp}.jsonl`
  - Compresser en .gz (non bloquant)
  - Impact: Maintient fichier logs sous contrÃ´le

#### **Phase 3: Console.log Production Mode (30min)** ğŸŸ¡ MEDIUM
- [x] [P0] CrÃ©er webview/ui/src/utils/logger.ts @rl4:id=webview-logger @rl4:verified="2025-11-17T13:34:00Z"
  - Class WebViewLogger avec rotation (max 100 logs)
  - MÃ©thodes: log(), error(), warn()
  - Production mode: Rotation automatique, pas de console.log natif
  - Impact: -70% croissance renderer

- [x] [P0] Remplacer console.log dans App.tsx @rl4:id=replace-console-log @rl4:verified="2025-11-17T13:34:00Z"
  - Import logger from './utils/logger'
  - Remplacer tous les console.log par logger.log
  - Garder console.error pour erreurs critiques
  - Dependencies: webview-logger doit exister

#### **Phase 4: JSONL Rotation (30min)** ğŸŸ¢ LOW
- [x] [P0] Ajouter rotation dans AppendOnlyWriter.ts @rl4:id=jsonl-rotation @rl4:verified="2025-11-17T13:35:00Z"
  - Fonction `rotateIfNeeded()`: Check > 10K lignes
  - Archiver en `{filename}-{timestamp}.jsonl`
  - Compresser .gz en background (async)
  - Impact: Maintient JSONL files < 10K lignes (long-term)

#### **Phase 5: Memory Watchdog (15min)** ğŸŸ¢ LOW
- [x] [P0] CrÃ©er MemoryWatchdog.ts @rl4:id=memory-watchdog @rl4:verified="2025-11-17T13:38:00Z"
  - Check RAM toutes les minutes via MemoryMonitor
  - Alert VS Code notification si > 500 MB
  - Log metrics pour debugging
  - Dependencies: MemoryMonitor.ts doit exister

- [x] [P0] Activer dans extension.ts @rl4:id=activate-watchdog @rl4:verified="2025-11-17T13:38:00Z"
  - Instancier MemoryWatchdog au dÃ©marrage
  - Start monitoring avec threshold 500 MB
  - Stocker dans context.subscriptions
  - Dependencies: memory-watchdog doit exister

---

### ğŸ”´ SPRINT P0-HARDENING: Production Stability (1h35min estimated)

**ğŸ¯ OBJECTIF:** Garantir stabilitÃ© RL4 en production (Scheduler, Ledger, Config)

#### **Phase 0: Scheduler Stability (20min)** ğŸ”´ CRITICAL
- [x] [P0] Garantir reset isRunning @rl4:id=P0-HARDENING-01 @rl4:verified="2025-11-17T15:35:00Z"
  - âœ… Wrap entire runCycle() in outermost try/finally with guaranteed isRunning = false
  - âœ… Target: extension/kernel/CognitiveScheduler.ts:385-527
  - âœ… Added outer try block (line 394) and outer finally block (line 523-526)
  - âœ… Moved isRunning = false from inner finally (line 475) to outer finally (line 525)
  - âœ… Verification: All return paths now pass through outer finally, guaranteed reset
  - Impact: Prevents scheduler deadlock on unhandled errors (OOM, stack overflow, post-processing failures)

#### **Phase 1: Ledger Stability (45min)** ğŸŸ  HIGH
- [x] [P0] Stabiliser cache Merkle @rl4:id=P0-HARDENING-02 @rl4:verified="2025-11-17T15:50:00Z"
  - âœ… Moved lastCycleMerkleRoot initialization to constructor (eager load)
  - âœ… Added circuit breaker: initializeMerkleCache() with try/catch fallback to genesis
  - âœ… Removed lazy-load block (lines 260-264) from appendCycle()
  - âœ… Target: extension/kernel/RBOMLedger.ts:54-317
  - âœ… New method initializeMerkleCache() (lines 304-317)
  - âœ… Constructor call at line 78
  - âœ… Genesis fallback documented (line 265)
  - âœ… Verification: Simulate disk corruption, ledger continues appending with genesis fallback
  - Impact: Prevents circular dependency, eliminates lazy-load surprise latency, guarantees robustness on disk failure

#### **Phase 2: Production Config (30min)** ğŸ”´ CRITICAL
- [x] [P0] Enforcer config PROD par dÃ©faut @rl4:id=P0-HARDENING-03 @rl4:verified="2025-11-17T16:00:00Z"
  - âœ… Changed default cognitive_cycle_interval_ms from 10000 to 7200000 (2h production)
  - âœ… Added TEST_MODE flag to KernelConfig interface (optional boolean)
  - âœ… Added validation: if cognitive_cycle_interval_ms < 60000 AND TEST_MODE !== true â†’ throw error
  - âœ… Created .reasoning_rl4/kernel_config.json with production defaults (7200000ms, TEST_MODE: false)
  - âœ… Target: extension/kernel/config.ts:11-69
  - âœ… Config auto-generated on first load if missing (line 44-48)
  - âœ… Verification: Extension activation with no config â†’ uses 2h cycles; with TEST_MODE: true â†’ allows 10s cycles
  - Impact: Prevents resource exhaustion in production (720x fewer cycles than old default)

---

### ğŸ”µ SPRINT P1-INTEGRITY: Ledger Verification & Hardening (Completed)

**ğŸ¯ OBJECTIF:** Verify integrity of Merkle chain and ledger correctness

#### **Phase 0: Merkle Circularity Check (15min)** ğŸ”µ COMPLETED
- [x] [P1] Investigate alleged Merkle circular reference @rl4:id=P1-INTEGRITY-01 @rl4:verified="2025-11-17T16:10:00Z"
  - âœ… Reviewed RBOMLedger.appendCycle() (lines 262-287)
  - âœ… Reviewed RBOMLedger.verifyChain() (lines 323-354)
  - âœ… Reviewed all Merkle computation and verification code paths
  - âœ… Result: NO-BUG (false positive)
  - âœ… Confirmation: merkleRoot computed from phase hashes ONLY, BEFORE cycle object construction
  - âœ… Confirmation: verifyChain() recomputes from same phase hashes (no self-inclusion)
  - âœ… Confirmation: No code path hashes object containing merkleRoot
  - Impact: Integrity of ledger chain confirmed for v3.5.11
  - Note: "P1-INTEGRITY-01 closed as FALSE POSITIVE â€” no circular Merkle dependency in current RBOMLedger implementation."

#### **Phase 1: Critical Integrity Patches (2h)** ğŸ”µ COMPLETED
- [x] [P1] PATCH 2: Flush-Before-Cache-Update @rl4:id=P1-INTEGRITY-02-PATCH-2 @rl4:verified="2025-11-17T16:30:00Z"
  - âœ… Target: RBOMLedger.appendCycle() (lines 283-320)
  - âœ… Added flush verification with 3 retries (exponential backoff: 100ms, 200ms, 400ms)
  - âœ… Cache update ONLY after verified flush (prevents stale prevMerkleRoot)
  - âœ… Throws error if all retries exhausted (prevents silent corruption)
  - Impact: Eliminates cache desync risk after crash (Risk Vector 2)

- [x] [P1] PATCH 5: Partial Write Validator @rl4:id=P1-INTEGRITY-02-PATCH-5 @rl4:verified="2025-11-17T16:30:00Z"
  - âœ… Target: AppendOnlyWriter (lines 89-152, 210-245)
  - âœ… Added validateLastLine() method (reads last 1KB, validates JSON, truncates if invalid)
  - âœ… Called before rotation (line 163) and before readAll() (line 216)
  - âœ… Automatic truncation to last valid newline on corruption detection
  - Impact: Prevents unparseable JSONL from disk-full or crash scenarios (Corruption Vector 1)

- [x] [P1] PATCH 6: Ledger Integrity Verification on Startup @rl4:id=P1-INTEGRITY-02-PATCH-6 @rl4:verified="2025-11-17T16:30:00Z"
  - âœ… Target: RBOMLedger.initializeMerkleCache() (lines 343-370) + appendCycle() (lines 265-268)
  - âœ… Added SAFE MODE flag: blocks appendCycle() if chain verification fails
  - âœ… Deep verification on startup (verifyChain({deep:true}))
  - âœ… Corruption reason stored and logged (user-facing diagnostics)
  - âœ… Added getStatus() method for monitoring SAFE MODE state
  - Impact: Prevents extension from extending corrupted chain (Corruption Vector 3, 6)

---

### âœ… E4.1 â€” Memory Safety (Completed)

**Sprint complÃ©tÃ©:** 2025-11-17T14:50  
**Fichiers modifiÃ©s:** 6 (IDEActivityListener, BuildMetricsListener, extension, ExecPool, AppendOnlyWriter, App.tsx)  
**Fichiers crÃ©Ã©s:** 3 (MemoryMonitor.ts, MemoryWatchdog.ts, logger.ts)  
**Lignes ajoutÃ©es:** ~423  
**Bias incrÃ©mentÃ©:** 30.61%  
**Extension version:** v3.5.11  
**Status:** âœ… DONE

---

### ğŸ¯ SPRINT PRODUCTION-READY MODE: P0 Core (6h estimated) â€” READY

**âœ… UNBLOCKED:** Sprint E4.1 Memory Safety complÃ©tÃ© (2025-11-17T14:50)

#### **Phase 1: Core Analysis Engine (4h)** ğŸ”´ NEW
- [ ] [P0] CrÃ©er ProductionReadyAnalyzer.ts
  - Analyse Ã©tat kernel: HealthMonitor, MemoryMonitor, CognitiveScheduler
  - Analyse JSONL files: Taille, derniÃ¨re modification, rotation active
  - Analyse timers/watchers: Count actifs, disposables status
  - Retourne ProductionReadinessReport { healthScore, memoryScore, jsonlScore, timersScore, overallScore, criticalIssues[], recommendations[] }
  - Calcul score 0-100% basÃ© sur thresholds simples
  - @rl4:id=prod-analyzer-minimal @rl4:completeWhen="file exists: extension/kernel/cognitive/ProductionReadyAnalyzer.ts"

- [ ] [P0] CrÃ©er ProductionReadySnapshotBuilder.ts
  - GÃ©nÃ¨re snapshot spÃ©cial "Production-Ready" (format texte Markdown)
  - Sections: 1) Overall Score, 2) Critical Issues, 3) Metrics Summary, 4) Recommendations
  - Appelle ProductionReadyAnalyzer pour collecter donnÃ©es
  - Format output: Markdown structurÃ© copiable dans clipboard
  - Pas d'UI complexe, juste texte
  - @rl4:id=prod-snapshot-minimal @rl4:completeWhen="file exists: extension/kernel/cognitive/ProductionReadySnapshotBuilder.ts"

- [ ] [P0] CrÃ©er HardeningEngine.ts (version minimale)
  - Interface HardeningRecommendation { id, category, severity, description, rationale }
  - MÃ©thode analyzeWorkspace(): DÃ©tecte issues basiques (memory > 500MB, JSONL > 10K lignes, timers > 20)
  - MÃ©thode generateRecommendations(): Retourne liste d'actions recommandÃ©es (texte uniquement, pas d'exÃ©cution)
  - CatÃ©gories: memory, jsonl_size, timers_count, watchers_count
  - Pas d'executor Ã  ce stade, juste analyse + recommandations
  - @rl4:id=hardening-engine-minimal @rl4:completeWhen="file exists: extension/kernel/cognitive/HardeningEngine.ts"

#### **Phase 2: Command & UI Integration (2h)** ğŸŸ¡ NEW
- [ ] [P0] Ajouter commande "Generate Production-Ready Snapshot"
  - Handler dans extension.ts: reasoning.snapshot.productionReady
  - Appelle ProductionReadySnapshotBuilder.generate()
  - Copie rÃ©sultat dans clipboard automatiquement
  - Affiche notification VS Code: "Production-Ready Snapshot copied (Score: X%)"
  - Pas de webview Ã  ce stade, juste commande
  - @rl4:id=prod-command-minimal @rl4:completeWhen="grep -n 'reasoning.snapshot.productionReady' extension/extension.ts"

- [ ] [P0] Ajouter bouton "Production Check" dans Control Tab
  - Positionner aprÃ¨s "Generate Snapshot" (dans le Control Tab existant)
  - Style: Orange/warning pour diffÃ©renciation
  - onClick: Appelle commande reasoning.snapshot.productionReady
  - Tooltip: "Run production-readiness analysis"
  - Pas de nouveau tab, juste bouton dans UI existante
  - @rl4:id=prod-button-minimal @rl4:completeWhen="grep -n 'Production Check' extension/webview/ui/src/App.tsx"

- [ ] [P0] CrÃ©er JSONL log pour tracking
  - Fichier: .reasoning_rl4/production-checks.jsonl
  - Format: { timestamp, overallScore, criticalIssuesCount, memoryMB, jsonlSizeKB, timersCount }
  - Ã‰crit automatiquement Ã  chaque exÃ©cution de production check
  - Permet historique des scores dans le temps
  - @rl4:id=prod-log-minimal @rl4:completeWhen="grep -n 'production-checks.jsonl' extension/kernel/cognitive/ProductionReadySnapshotBuilder.ts"

---

### ğŸ¯ SPRINT E5: Pattern Learning UI (6h estimated) â€” PAUSED

**âš ï¸ BLOCKER:** Sprint E4.1 Memory Safety DOIT Ãªtre complÃ©tÃ© AVANT

#### **Phase 1: Terminal Patterns Display (2h)** ğŸ”´ NEW
- [ ] [P0] CrÃ©er onglet "Patterns" dans Insights Tab
  - Lire `terminal-patterns.json` via message handler
  - Afficher patterns appris (table format)
  - Colonnes: Task Title, Runs, Success Rate, Avg Duration, Last Run, Suggested Condition
  - @rl4:id=patterns-tab @rl4:completeWhen="grep -n 'Patterns.*Tab' webview/ui/src/App.tsx"

- [ ] [P0] CrÃ©er `PatternsCard` component
  - Props: `{ patterns: TaskPattern[] }`
  - Card par pattern avec dÃ©tails
  - Success/Failure runs breakdown
  - Duration histogram (visual)
  - Command classification badge (setup/build/test/debug/deploy)
  - @rl4:id=patterns-card @rl4:completeWhen="file exists: webview/ui/src/components/PatternsCard.tsx"

- [ ] [P0] CrÃ©er section Anomalies dans Patterns Tab
  - Lire anomalies depuis TerminalPatternsLearner
  - Afficher success rate drops (>20%)
  - Afficher unusual durations (>2Ïƒ)
  - Afficher command changes dÃ©tectÃ©s
  - Color-coding par sÃ©vÃ©ritÃ© (red/orange/yellow)
  - @rl4:id=patterns-anomalies @rl4:completeWhen="grep -n 'Pattern Anomalies' webview/ui/src/App.tsx"

#### **Phase 2: Auto-Suggestions UI (2h)** ğŸŸ¡ NEW
- [ ] [P0] DÃ©tection tÃ¢ches sans `@rl4:completeWhen`
  - Scanner Tasks.RL4 dans TasksRL4Parser
  - Matcher avec patterns existants (fuzzy matching 60%)
  - Retourner suggestions avec confidence score
  - @rl4:id=detect-missing-conditions @rl4:completeWhen="grep -n 'suggestForTask' kernel/cognitive/TerminalPatternsLearner.ts"

- [ ] [P0] UI "Suggested Conditions" dans Dev Tab
  - Section "ğŸ’¡ Suggestions" en haut du Dev Tab
  - Afficher tÃ¢ches sans conditions + suggestions
  - Bouton "Apply Suggestion" par tÃ¢che
  - Confidence badge (HIGH/MEDIUM/LOW)
  - @rl4:id=suggestions-ui @rl4:completeWhen="grep -n 'Suggested Conditions' webview/ui/src/App.tsx"

- [ ] [P0] Handler `applySuggestion` dans extension.ts
  - ReÃ§oit `{ taskId, suggestedCondition }`
  - Met Ã  jour Tasks.RL4 avec `@rl4:completeWhen`
  - Log dans decisions.jsonl (type: 'suggestion_applied')
  - Envoie message Ã  WebView pour refresh
  - @rl4:id=apply-suggestion-handler @rl4:completeWhen="grep -n 'case.*applySuggestion' extension/extension.ts"

#### **Phase 3: Ad-Hoc Actions Tracker (2h)** ğŸŸ¢ NEW
- [ ] [P1] CrÃ©er `AdHocTracker.ts` component
  - Fonction `trackAction(action, context)`
  - Ã‰crit dans `.reasoning_rl4/ad-hoc-actions.jsonl`
  - Format: `{ timestamp, action, context, suggested: boolean }`
  - Fonction `getSuggestions()` â†’ Retourne actions Ã  convertir
  - @rl4:id=adhoc-tracker @rl4:completeWhen="file exists: extension/kernel/api/AdHocTracker.ts"

- [ ] [P1] Support marqueur `# RL4_ACTION` dans scripts
  - DÃ©tection dans helper scripts (rl4-log.sh)
  - Nouvelle fonction `rl4_action(description)`
  - Ã‰crit dans ad-hoc-actions.jsonl
  - @rl4:id=adhoc-marker @rl4:completeWhen="grep -n 'RL4_ACTION' scripts/rl4-log.sh"

- [ ] [P1] Enrichir snapshot avec ad-hoc actions
  - AdaptivePromptBuilder lit ad-hoc-actions.jsonl
  - Section "Unplanned Actions" dans prompt
  - SuggÃ¨re conversion en tÃ¢ches formelles
  - @rl4:id=adhoc-snapshot @rl4:completeWhen="grep -n 'ad-hoc-actions' kernel/cognitive/AdaptivePromptBuilder.ts"

- [ ] [P1] UI "Suggested from Activity" dans Dev Tab
  - Section en bas du Dev Tab
  - Badge "ğŸ”§ Ad-Hoc" sur proposals
  - Bouton "Convert to Task" â†’ Ajoute dans Tasks.RL4
  - Liste des actions rÃ©centes non planifiÃ©es
  - @rl4:id=adhoc-ui @rl4:completeWhen="grep -n 'Suggested from Activity' webview/ui/src/App.tsx"

---

### âœ… COMPLETED (Sprint E4 - Session du 16 Nov 2025)

**Phase 1: Parse LLM Response (1h)** âœ… COMPLÃ‰TÃ‰
- [x] [P0] ImplÃ©menter handler `parseLLMResponse` dans extension.ts @rl4:id=parse-llm-handler @rl4:verified="2025-11-16T07:30:00Z"
  - âœ… Lit clipboard: `vscode.env.clipboard.readText()`
  - âœ… 4 patterns de parsing (fenced, RL4_PROPOSAL, raw JSON)
  - âœ… Parse JSON et extrait `suggestedTasks[]`
  - âœ… Ã‰crit dans `.reasoning_rl4/proposals.json`
  - âœ… Envoie messages `proposalsParsed` / `parseError` Ã  WebView
  - âœ… Feedback utilisateur via VS Code notifications

- [x] [P0] Ajouter bouton "ğŸ“‹ Parse LLM Response" dans Control Tab @rl4:id=ui-parse-button @rl4:verified="2025-11-16T07:35:00Z"
  - âœ… PositionnÃ© aprÃ¨s "Generate Snapshot"
  - âœ… onClick: `window.vscode.postMessage({ type: 'parseLLMResponse' })`
  - âœ… Affiche feedback: "âœ… X proposals parsed"
  - âœ… Style: secondaryBackground (diffÃ©renciation visuelle)

- [x] [P0] Test workflow clipboard â†’ proposals.json @rl4:id=test-parse-workflow @rl4:verified="manual"
  - âœ… Workflow vÃ©rifiÃ©: Copy â†’ Click â†’ proposals.json updated â†’ Dev Tab refresh

**Phase 2: Helper Scripts Terminal (2h)** âœ… COMPLÃ‰TÃ‰
- [x] [P0] CrÃ©er `scripts/rl4-log.js` (Node.js helper) @rl4:id=helper-node @rl4:verified="2025-11-16T07:42:00Z"
  - âœ… 162 lignes, 3.9K (executable)
  - âœ… Functions: findWorkspaceRoot, appendEvent, main (start/end/custom)
  - âœ… Usage: `node scripts/rl4-log.js start task-001 "npm test"`

- [x] [P0] CrÃ©er `scripts/rl4-log.sh` (Bash helper) @rl4:id=helper-bash @rl4:verified="2025-11-16T07:43:00Z"
  - âœ… 198 lignes, 4.3K (executable)
  - âœ… 5 fonctions: rl4_task_start, rl4_task_result, rl4_file_created, rl4_git_commit, rl4_run
  - âœ… Exports + helper message on load

- [x] [P0] CrÃ©er README_RL4_TERMINAL.md @rl4:id=terminal-docs @rl4:verified="2025-11-16T07:44:00Z"
  - âœ… 443 lignes, 9.3K (complete guide)
  - âœ… Sections: What/How/Examples/FAQ/Troubleshooting (12 sections)

**Phase 3: Documentation (1h)** âœ… COMPLÃ‰TÃ‰
- [x] [P0] Mettre Ã  jour README.md @rl4:id=readme-update @rl4:verified="2025-11-16T07:50:00Z"
  - âœ… Section "What's New in v3.5.8" ajoutÃ©e
  - âœ… Section "Phase E3.4 Achievements" complÃ¨te
  - âœ… Section "Dev Tab Workflow" (5 Ã©tapes)
  - âœ… Section "Terminal RL4 Usage" (quick start)

- [x] [P0] CrÃ©er RELEASE_NOTES_v3.5.8.md @rl4:id=release-notes @rl4:verified="2025-11-16T07:55:00Z"
  - âœ… Structure complÃ¨te (features/tech/metrics)
  - âœ… Getting Started workflow
  - âœ… Known Issues + Roadmap

---

### âœ… COMPLETED (Last 24h - Session du 16 Nov 2025)

**Phase 1: Core Infrastructure**
- [x] [P0] Create PromptOptimizer.ts (357 lines) @rl4:id=prompt-optimizer @rl4:verified="2025-11-16T06:00:00Z"
  - Compression mode strict: Focus P0, supprime redondances
  - Compression mode flexible: P0+P1, garde contexte riche
  - Compression mode exploratory/free: Minimal/aucune compression
  - Retourne mÃ©triques: originalSize, optimizedSize, reductionPercent

- [x] [P0] Create AnomalyDetector.ts (345 lines) @rl4:id=anomaly-detector @rl4:verified="2025-11-16T06:00:00Z"
  - DÃ©tection: sudden_change, regression, unusual_activity, bias_spike, plan_drift
  - Severity: low/medium/high/critical
  - Format: { type, severity, description, context, recommendation, timestamp }
  - Sauvegarde dans anomalies.jsonl

- [x] [P0] Update UnifiedPromptBuilder.ts @rl4:id=unified-prompt-metadata @rl4:verified="2025-11-16T06:00:00Z"
  - Retour modifiÃ©: `{ prompt: string, metadata: { anomalies, compression } }`
  - Appelle AnomalyDetector.detectAnomalies() avant gÃ©nÃ©ration
  - Appelle PromptOptimizer.optimize() aprÃ¨s gÃ©nÃ©ration
  - Sections ajoutÃ©es: Engine-Generated Data, Anomalies Detected
  - SchÃ©mas LLM: RL4_PROPOSAL, RL4_DECISION_REQUEST, RL4_TASKS_PATCH

- [x] [P0] Update AdaptivePromptBuilder.ts @rl4:id=adaptive-compat @rl4:verified="2025-11-16T06:00:00Z"
  - Fix: Extraction result.prompt pour backward compatibility
  - Maintient type retour Promise<string>

**Phase 2: Snapshot Reminder System**
- [x] [P0] Create SnapshotReminder.ts @rl4:id=snapshot-reminder @rl4:verified="2025-11-16T06:00:00Z"
  - Timer: check toutes les 30min si dernier snapshot >2h
  - getReminderContext(): Analyse Tasks.RL4 + cycles.jsonl â†’ recommande mode
  - showReminder(): VS Code info message avec CTAs (Generate & Copy / Remind me later)
  - Persistence: .last_snapshot_timestamp

**Phase 3: Extension Hub Integration**
- [x] [P0] Integrate SnapshotReminder in extension.ts @rl4:id=extension-reminder @rl4:verified="2025-11-16T06:00:00Z"
  - Initialisation + start()
  - recordSnapshotGenerated() aprÃ¨s snapshot
  - cleanup dans deactivate()

- [x] [P0] Add metadata to WebView @rl4:id=webview-metadata @rl4:verified="2025-11-16T06:00:00Z"
  - Message snapshotMetadata: { anomalies, compression }
  - Logs console pour debug

- [x] [P0] Create RL4 Terminal command @rl4:id=rl4-terminal @rl4:verified="2025-11-16T06:00:00Z"
  - Commande: reasoning.terminal.openRL4
  - CrÃ©e terminal "RL4 Terminal"
  - Initialise rl4TerminalEventsWriter (AppendOnlyWriter â†’ terminal-events.jsonl)
  - Pas de listener API VS Code (mode hacking, file-based)

**Phase 4: LLM Proposal Workflow**
- [x] [P0] Implement proposals.json workflow @rl4:id=proposals-workflow @rl4:verified="2025-11-16T06:00:00Z"
  - File created au dÃ©marrage avec template { suggestedTasks: [] }
  - FileWatcher envoie proposalsUpdated au WebView
  - Handler submitDecisions: gÃ©nÃ¨re preview RL4_TASKS_PATCH
  - Handler applyPatch: applique changements Ã  Tasks.RL4
  - Bias guard: vÃ©rifie threshold (25% flexible)
  - Structured logging: decisions.jsonl (preview_generated, patch_applied, apply_aborted_bias)

**Phase 5: WebView UI Complete**
- [x] [P0] Update App.tsx with 4 tabs @rl4:id=app-tabs @rl4:verified="2025-11-16T06:00:00Z"
  - Control: Snapshot generation + GitHub features
  - Dev: Validation tasks proposÃ©es + real-time tracking
  - Insights: KPI dashboard
  - About: Info cards

- [x] [P0] Add Dev Tab state @rl4:id=dev-state @rl4:verified="2025-11-16T06:00:00Z"
  - anomalies: Liste des anomalies dÃ©tectÃ©es
  - compressionMetrics: MÃ©triques de compression
  - proposals: TÃ¢ches proposÃ©es par LLM
  - patchPreview: Preview du patch RL4_TASKS_PATCH
  - devBadge: Compteur notifications
  - taskVerifications: Map<taskId, TaskVerification>

- [x] [P0] Add Dev Tab message handlers @rl4:id=dev-handlers @rl4:verified="2025-11-16T06:00:00Z"
  - snapshotMetadata: RÃ©ception anomalies + compression
  - proposalsUpdated: Mise Ã  jour liste propositions
  - patchPreview: Affichage patch avant application
  - taskLogChanged: RafraÃ®chissement aprÃ¨s application
  - taskVerificationResults: Affichage "Verified by RL4"
  - taskMarkedDone: Suppression verification aprÃ¨s marquage done

- [x] [P0] Create AnomaliesCard.tsx component @rl4:id=anomalies-card @rl4:verified="2025-11-16T06:00:00Z"
  - Affichage type + sÃ©vÃ©ritÃ© (ğŸ”´/ğŸŸ¡/ğŸŸ¢)
  - Description + contexte
  - Recommandations

**Phase 6: Task Verification Engine (TODAY)**
- [x] [P0] Create TasksRL4Parser.ts (108 lines) @rl4:id=tasks-parser @rl4:verified="2025-11-16T06:30:00Z"
  - Parse Tasks.RL4 et extrait markers @rl4:id / @rl4:completeWhen
  - Interface TaskRL4Marker { id, completeWhen[], rawText, lineNumber }
  - Method checkCondition(condition, event): vÃ©rifie si Ã©vÃ©nement satisfait condition
  - Patterns: exitCode 0, test passing, npm success, file created, git commit, output contains

- [x] [P0] Create TaskVerificationEngine.ts (195 lines) @rl4:id=verification-engine @rl4:verified="2025-11-16T06:30:00Z"
  - Interface TerminalEvent { timestamp, type, taskId?, command?, exitCode?, output? }
  - Interface TaskVerificationResult { taskId, verified, verifiedAt?, matchedConditions, matchedEvents, confidence, suggestion }
  - Method verifyAllTasks(): lit Tasks.RL4 + terminal-events.jsonl â†’ calcule verifications
  - Method calculateConfidence(): high (100% + exitCode 0), medium (>50%), low (<50%)
  - Cursor de lecture: lastProcessedLine (Ã©vite retraiter Ã©vÃ©nements)

- [x] [P0] Integrate TaskVerificationEngine in extension.ts @rl4:id=extension-verification @rl4:verified="2025-11-16T06:30:00Z"
  - Initialisation lazily au premier openRL4
  - VÃ©rification pÃ©riodique toutes les 10s
  - Envoie taskVerificationResults au WebView
  - Handler markTaskDone: remplace [ ] par [x] + ajoute @rl4:completedAt timestamp

- [x] [P0] Add Task Verification UI in Dev Tab @rl4:id=dev-verification-ui @rl4:verified="2025-11-16T06:30:00Z"
  - Section "âœ… Verified Tasks (RL4)"
  - Badge de confiance: HIGH (vert), MEDIUM (orange), LOW (gris)
  - Affichage conditions matchÃ©es + timestamp
  - Bouton "Mark as Done"
  - DÃ©tails pliables (conditions, Ã©vÃ©nements)

- [x] [P0] Compile & Package extension v3.5.8 @rl4:id=compile-package @rl4:verified="2025-11-16T06:30:00Z"
  - npm run compile (717 KiB)
  - npm run build webview (307.85 KiB)
  - No linting errors
  - Extension ready to test

**Phase 7: Terminal Patterns Learning (FINAL)** ğŸ§ 
- [x] [P0] Create TerminalPatternsLearner.ts (450+ lines) @rl4:id=pattern-learner @rl4:verified="2025-11-16T06:45:00Z"
  - Interface TaskPattern { taskId, typicalCommands[], successRate, avgDuration, runsCount, completeWhen }
  - Interface CommandClassification { command, phase, confidence }
  - Interface PatternAnomaly { taskId, type, severity, description, expected, actual, recommendation }
  - Method learnFromEvents(events): Analyse Ã©vÃ©nements et met Ã  jour patterns
  - Method suggestCompleteWhen(taskTitle): Auto-suggest based on fuzzy matching + heuristics
  - Method detectAnomalies(taskId, events): DÃ©tecte success rate drop, unusual duration, command change
  - Method classifyCommand(command): DÃ©tecte phase (setup/build/test/debug/deploy/document)
  - Persistence: terminal-patterns.json
  - Fuzzy matching: Jaccard similarity pour trouver tÃ¢ches similaires

**Phase 8: Automated Testing Suite** âœ…
- [x] [P0] Create comprehensive test automation script @rl4:id=test-automation @rl4:verified="2025-11-16T09:00:00Z"
  - 10 test suites, 46 tests total (45 passed, 1 minor pattern match)
  - Suite 1-7: Installation, structure, permissions, rules (100% pass)
  - Suite 8: Content validation (COMPLETED/Done section detection)
  - Suite 9: Snapshot reminder timestamp (ISO 8601 format)
  - Suite 10: Integration checks (terminal-events â†” Tasks.RL4 coherence, bias validation)
  - Test data: proposals.json (3 suggestions, 16% bias), terminal-events.jsonl (9 events, 4 tasks)
  - Validation: File structure, JSONL format, JSON schemas, marker presence
  - Success rate: 97.8%

### ğŸ”¥ CURRENT SPRINT (Dev Tab Completion)

#### **Phase 1: Auto-parsing LLM Response**
- [ ] [P0] Ajouter commande `parseLLMResponse` dans extension.ts
  - Handler lit clipboard (`vscode.env.clipboard.readText()`)
  - Regex cherche bloc `RL4_PROPOSAL` (supporte JSON fenced ou raw)
  - Parse JSON et extrait `suggestedTasks[]`
  - Ã‰crit dans `.reasoning_rl4/proposals.json`
  - Envoie message `proposalsParsed` Ã  WebView
  - @rl4:id=parse-llm @rl4:completeWhen="npm test -- parseLLMResponse"

- [ ] [P0] Ajouter bouton "ğŸ“‹ Parse LLM Response" dans Control Tab
  - Positionner aprÃ¨s "Generate Snapshot"
  - Appelle `window.vscode.postMessage({ type: 'parseLLMResponse' })`
  - Affiche feedback : "âœ… X proposals parsed"
  - @rl4:id=ui-parse-button

#### **Phase 2: Terminal Helper Scripts**
- [ ] [P0] CrÃ©er `scripts/rl4-log.js` (Node.js helper)
  - Fonction `logTaskStart(id, command)`
  - Fonction `logTaskResult(id, status, exitCode)`
  - Ã‰crit dans `.reasoning_rl4/terminal-events.jsonl` (append)
  - Format : `{ type, timestamp, taskId, command?, status?, exitCode?, terminal: "RL4" }`
  - @rl4:id=helper-node @rl4:completeWhen="node scripts/rl4-log.js --test"

- [ ] [P0] CrÃ©er `scripts/rl4-log.sh` (Bash helper)
  - Fonctions `rl4_task_start()` et `rl4_task_result()`
  - Echo marqueurs `# RL4_TASK_START` / `# RL4_TASK_RESULT`
  - Optionnel : Ã‰crit aussi dans terminal-events.jsonl
  - @rl4:id=helper-bash @rl4:completeWhen="bash scripts/rl4-log.sh test"

- [ ] [P0] CrÃ©er README pour Terminal RL4
  - Documentation des marqueurs `# RL4_TASK_*`
  - Exemples d'utilisation des scripts
  - Format attendu dans terminal-events.jsonl
  - @rl4:id=terminal-docs

#### **Phase 3: TaskVerificationEngine**
- [ ] [P0] CrÃ©er `extension/kernel/api/TaskVerificationEngine.ts`
  - Interface `TerminalEvent { type, timestamp, taskId, command?, status?, exitCode?, durationMs? }`
  - Interface `TaskMetadata { id, title, rl4Id?, completeWhen?, priority }`
  - Interface `TaskVerification { taskId, verified, lastEvent?, verifiedAt?, duration? }`
  - MÃ©thode `loadTerminalEvents(since?: Date): TerminalEvent[]`
  - MÃ©thode `parseTaskMetadata(tasksContent: string): TaskMetadata[]`
  - MÃ©thode `verifyTasks(tasks, events): TaskVerification[]`
  - @rl4:id=verification-engine @rl4:completeWhen="npm test -- TaskVerificationEngine"

- [ ] [P0] Ã‰tendre `PlanTasksContextParser.ts` pour parser `@rl4:id`
  - Regex pour extraire `@rl4:id=([A-Za-z0-9_\-:.]+)`
  - Regex pour extraire `@rl4:completeWhen="([^"]+)"`
  - Ajouter champs `rl4Id?` et `completeWhen?` Ã  l'interface Task
  - @rl4:id=parser-metadata @rl4:completeWhen="npm test -- PlanTasksContextParser"

#### **Phase 4: Integration Dev Tab**
- [ ] [P0] Ajouter handler `refreshTaskVerification` dans extension.ts
  - Instancier `TaskVerificationEngine`
  - Charger `Tasks.RL4` et `terminal-events.jsonl`
  - Calculer verifications
  - Envoyer Ã  WebView : `{ type: 'taskVerificationsUpdated', payload: verifications[] }`
  - @rl4:id=handler-verification

- [ ] [P0] Ajouter state `taskVerifications` dans App.tsx
  - State: `Map<string, TaskVerification>`
  - Listener message `taskVerificationsUpdated`
  - Merge avec proposals existantes
  - @rl4:id=ui-verification-state

- [ ] [P0] Afficher badge "âœ… Verified by RL4" dans Dev Tab
  - Pour chaque proposal, checker si `taskVerifications.has(item.rl4Id)`
  - Si verified: afficher badge vert avec timestamp
  - Style : `{ color: '#4caf50', fontSize: '10px', fontWeight: 'bold' }`
  - @rl4:id=ui-verified-badge

- [ ] [P0] Auto-refresh verification toutes les 30s
  - `setInterval(() => refreshTaskVerification(), 30000)`
  - DÃ©clencher aussi au clic sur Dev Tab
  - @rl4:id=auto-refresh

#### **Phase 5: Auto-Completion & Mark as Done** ğŸš€
- [ ] [P0] Ajouter handler `markTaskDone` dans extension.ts
  - Lit Tasks.RL4
  - Trouve ligne avec `@rl4:id=taskId`
  - Remplace `- [ ]` par `- [x]` + timestamp
  - Log dans decisions.jsonl: `{ event: 'task_completed', taskId, trigger: 'terminal', verified: true }`
  - @rl4:id=mark-done-handler @rl4:completeWhen="npm test -- markTaskDone"

- [ ] [P0] Ajouter bouton "Mark as Done" dans Dev Tab
  - AffichÃ© seulement si task.verified === true
  - Style: Bouton vert proÃ©minent
  - onClick: envoie `{ type: 'markTaskDone', taskId }`
  - Feedback: "âœ… Task marked as done"
  - @rl4:id=mark-done-ui

#### **Phase 6: Ad-Hoc Actions Tracking** ğŸ”§
- [ ] [P0] CrÃ©er `extension/kernel/api/AdHocTracker.ts`
  - Interface `AdHocAction { id, timestamp, description, files[], status, command? }`
  - MÃ©thode `trackAction(description, files, command)`
  - MÃ©thode `loadActions(since?: Date): AdHocAction[]`
  - Ã‰crit dans `.reasoning_rl4/ad-hoc-actions.jsonl`
  - @rl4:id=adhoc-tracker @rl4:completeWhen="npm test -- AdHocTracker"

- [ ] [P0] Support marqueurs `# RL4_ACTION` dans scripts
  - Format: `# RL4_ACTION adhoc=true description="..." files="..."`
  - Format result: `# RL4_ACTION_RESULT id=adhoc-001 status=success`
  - Parser dans rl4-log.js/sh
  - @rl4:id=adhoc-markers

- [ ] [P0] Enrichir snapshot avec ad-hoc actions
  - Section "Ad-hoc actions (last 24h)" dans UnifiedPromptBuilder
  - Liste description + files + timestamp
  - LLM peut proposer tasks basÃ©es sur ad-hoc
  - @rl4:id=snapshot-adhoc

- [ ] [P0] Afficher "Suggested from activity" dans Dev Tab
  - Nouvelle section sous "Proposed Tasks"
  - Badge ğŸ’¡ pour diffÃ©rencier des proposals normales
  - Boutons: [Accept P0/P1] [Backlog] [Ignore Forever]
  - @rl4:id=adhoc-ui

#### **Phase 7: Terminal Patterns Learning** ğŸ§ 
- [ ] [P0] CrÃ©er `extension/kernel/api/TerminalPatternsLearner.ts`
  - Interface `TaskPattern { taskId, typicalCommands[], successRate, avgDuration, runsCount }`
  - Interface `CommandClassification { command, phase }`
  - MÃ©thode `learnFromEvents(events: TerminalEvent[]): void`
  - MÃ©thode `suggestCompleteWhen(taskTitle: string): string?`
  - MÃ©thode `detectAnomalies(taskId, events): Anomaly[]`
  - Persist dans `.reasoning_rl4/terminal-patterns.json`
  - @rl4:id=pattern-learner @rl4:completeWhen="npm test -- TerminalPatternsLearner"

- [ ] [P0] Apprentissage automatique toutes les 30min
  - Job background dans CognitiveScheduler
  - AgrÃ¨ge terminal-events.jsonl (last 24h)
  - Update terminal-patterns.json
  - Log stats: `{ learned: 3 patterns, updated: 5 patterns }`
  - @rl4:id=pattern-learning-job

- [ ] [P0] Auto-suggestion `@rl4:completeWhen`
  - Quand nouvelle task ajoutÃ©e sans metadata
  - Cherche pattern similaire (fuzzy match titre)
  - Propose dans Dev Tab: "ğŸ’¡ Suggested: @rl4:completeWhen=..."
  - Boutons: [Apply] [Edit] [Ignore]
  - @rl4:id=suggest-completewhen

- [ ] [P0] Anomaly detection basÃ©e sur patterns
  - DÃ©tecte: success rate drop, unusual duration, command change
  - Affiche dans Insights Tab (AnomaliesCard)
  - Type: 'unusual_activity' avec context
  - Recommandation: "Check recent commits / dependencies"
  - @rl4:id=pattern-anomalies

#### **Phase 8: Testing & Documentation**
- [ ] [P0] Test workflow complet end-to-end
  1. GÃ©nÃ©rer snapshot en mode Exploratory
  2. Coller rÃ©ponse LLM â†’ Parse proposals
  3. Accepter une tÃ¢che â†’ Patch applied
  4. ExÃ©cuter dans RL4 Terminal avec marqueurs
  5. VÃ©rifier badge "Verified by RL4" apparaÃ®t
  6. Cliquer "Mark as Done" â†’ Task cochÃ©e
  7. Faire action ad-hoc â†’ VÃ©rifier tracking
  8. Attendre learning â†’ VÃ©rifier suggestions
  - @rl4:id=e2e-test @rl4:completeWhen="manual verification"

- [ ] [P0] Documenter workflow dans README.md
  - Section "Dev Tab Workflow"
  - Section "Terminal RL4 Usage"
  - Section "Ad-Hoc Actions"
  - Section "Pattern Learning"
  - Exemples de marqueurs RL4_TASK_* / RL4_ACTION
  - Screenshots si possible
  - @rl4:id=docs-workflow

#### **Phase 9: Memory Optimization (LATER)** ğŸ”§
- [ ] [P1] Fix retainContextWhenHidden in extension.ts
  - Changer `retainContextWhenHidden: true` â†’ `false` (ligne ~365)
  - Raison: WebView consomme 1.7 GB car contexte gardÃ© en mÃ©moire mÃªme fermÃ©
  - Impact attendu: RÃ©duction ~1 GB quand dashboard fermÃ©
  - @rl4:id=webview-retain-false @rl4:completeWhen="grep retainContextWhenHidden.*false extension/extension.ts"

- [ ] [P1] Remove 10s verification interval polling
  - Supprimer `setInterval(() => { ... }, 10000)` (ligne ~313-329)
  - Remplacer par event-driven: FileWatcher sur terminal-events.jsonl
  - Raison: Polling consomme CPU + accumule rÃ©sultats en RAM
  - @rl4:id=remove-polling @rl4:completeWhen="! grep -n 'setInterval.*10000' extension/extension.ts"

- [ ] [P1] Add React.memo to expensive components
  - Wrapper CognitiveLoadCard, NextStepsCard, AnomaliesCard avec React.memo
  - Add useMemo pour calculs lourds (parseContextRL4, etc.)
  - Raison: Re-renders inutiles consomment RAM
  - @rl4:id=react-memo @rl4:completeWhen="grep -c React.memo webview/ui/src/components/*.tsx | grep -v :0"

- [ ] [P1] Dispose FileWatchers when WebView closed
  - Stocker watchers dans array, dispose dans webviewPanel.onDidDispose
  - Raison: 5 watchers actifs 24/7 mÃªme dashboard fermÃ©
  - @rl4:id=cleanup-watchers @rl4:completeWhen="grep onDidDispose.*dispose.*watcher extension/extension.ts"

- [ ] [P1] Document memory optimization results
  - CrÃ©er MEMORY_OPTIMIZATION_RESULTS.md avec avant/aprÃ¨s
  - Mesurer: Extension Host + Cursor Helper (Renderer)
  - Target: <300 MB total (vs 1.9 GB actuel)
  - @rl4:id=memory-docs

## Active (P1) â€” HIGH PRIORITY

- [ ] [P1] Ajouter historique des dÃ©cisions dans Dev Tab
  - Lire `.reasoning_rl4/ledger/decisions.jsonl`
  - Afficher timeline des acceptations/rejets
  - Filtrer par date (derniÃ¨res 24h)

- [ ] [P1] AmÃ©liorer dÃ©tection duplicates
  - Comparer titre + why avec tÃ¢ches existantes (fuzzy matching)
  - Afficher score de similaritÃ©
  - SuggÃ©rer merge si > 80% similaire

- [ ] [P1] Ajouter export proposals vers markdown
  - Bouton "Export to Markdown"
  - Format : liste checkbox avec mÃ©tadonnÃ©es
  - Copie dans clipboard

## Backlog (P2+) â€” FUTURE

- [ ] [P2] Badge persistence (state file)
- [ ] [P2] Terminal patterns learning (terminal-patterns.json)
- [ ] [P2] Ad-hoc actions detection (ad-hoc-actions.jsonl)
- [ ] [P2] Task completion rate KPI (Insights Tab)
- [ ] [P2] Auto-suggest @rl4:completeWhen based on task type
- [ ] [P3] Visual timeline des task executions
- [ ] [P3] Integration avec GitHub Actions (CI/CD verification)

## Completed (Last Session)

- [x] Analyse exhaustive du MD (112295 lignes)
- [x] Identification composants manquants (AnomaliesCard, App.tsx tabs, Terminal)
- [x] Extraction contenus finaux fichiers RL4 depuis MD
- [x] Enrichissement Plan/Tasks/Context/ADRs.RL4
- [x] CrÃ©ation Plan de restauration dÃ©taillÃ©
- [x] Restauration code complet (3 fichiers modifiÃ©s/crÃ©Ã©s)
- [x] Build + Package + Install extension v3.5.8
- [x] Fix erreur React import
- [x] Rebuild + Reinstall extension (version corrigÃ©e)

## Notes de DÃ©veloppement

### Format Tasks.RL4 avec mÃ©tadonnÃ©es RL4
```markdown
- [ ] [P0] Task title @rl4:id=unique-id @rl4:completeWhen="exitCode=0"
- [x] [P0] Completed task @rl4:id=task-001 @rl4:verified="2025-11-16T04:30:00Z"
```

### Format terminal-events.jsonl
```json
{"type":"task_start","timestamp":"2025-11-16T04:15:00.000Z","taskId":"task-001","command":"npm test","terminal":"RL4"}
{"type":"task_result","timestamp":"2025-11-16T04:15:05.000Z","taskId":"task-001","status":"success","exitCode":0,"durationMs":5000,"terminal":"RL4"}
```

### Marqueurs Terminal RL4
```bash
# Format complet
echo '# RL4_TASK_START id=task-001 command="npm test"'
npm test
echo '# RL4_TASK_RESULT id=task-001 status=success exitCode=0'

# Format minimal (via helper)
source scripts/rl4-log.sh
rl4_task_start "task-001" "npm test"
npm test
rl4_task_result "task-001" "success" $?
```


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ§ª TEST TASKS (Automated Testing)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## Test Tasks - DO NOT MODIFY (Used by automated tests)

- [ ] [P0] Run test suite @rl4:id=auto-test-001 @rl4:completeWhen="exitCode 0"
- [ ] [P0] Build project successfully @rl4:id=auto-test-002 @rl4:completeWhen="build success"
- [ ] [P0] Create verification file @rl4:id=auto-test-003 @rl4:completeWhen="file exists: .test-verification.txt"
- [ ] [P1] Install dependencies @rl4:id=auto-test-004 @rl4:completeWhen="npm install" @rl4:completeWhen="exitCode 0"



# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ§ª TEST TASKS (Automated Testing)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## Test Tasks - DO NOT MODIFY (Used by automated tests)

- [ ] [P0] Run test suite @rl4:id=auto-test-001 @rl4:completeWhen="exitCode 0"
- [ ] [P0] Build project successfully @rl4:id=auto-test-002 @rl4:completeWhen="build success"
- [ ] [P0] Create verification file @rl4:id=auto-test-003 @rl4:completeWhen="file exists: .test-verification.txt"
- [ ] [P1] Install dependencies @rl4:id=auto-test-004 @rl4:completeWhen="npm install" @rl4:completeWhen="exitCode 0"



# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ§ª TEST TASKS (Automated Testing)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## Test Tasks - DO NOT MODIFY (Used by automated tests)

- [ ] [P0] Run test suite @rl4:id=auto-test-001 @rl4:completeWhen="exitCode 0"
- [ ] [P0] Build project successfully @rl4:id=auto-test-002 @rl4:completeWhen="build success"
- [ ] [P0] Create verification file @rl4:id=auto-test-003 @rl4:completeWhen="file exists: .test-verification.txt"
- [ ] [P1] Install dependencies @rl4:id=auto-test-004 @rl4:completeWhen="npm install" @rl4:completeWhen="exitCode 0"



# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ§ª TEST TASKS (Automated Testing)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## Test Tasks - DO NOT MODIFY (Used by automated tests)

- [ ] [P0] Run test suite @rl4:id=auto-test-001 @rl4:completeWhen="exitCode 0"
- [ ] [P0] Build project successfully @rl4:id=auto-test-002 @rl4:completeWhen="build success"
- [ ] [P0] Create verification file @rl4:id=auto-test-003 @rl4:completeWhen="file exists: .test-verification.txt"
- [ ] [P1] Install dependencies @rl4:id=auto-test-004 @rl4:completeWhen="npm install" @rl4:completeWhen="exitCode 0"



# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ§ª TEST TASKS (Automated Testing)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## Test Tasks - DO NOT MODIFY (Used by automated tests)

- [ ] [P0] Run test suite @rl4:id=auto-test-001 @rl4:completeWhen="exitCode 0"
- [ ] [P0] Build project successfully @rl4:id=auto-test-002 @rl4:completeWhen="build success"
- [ ] [P0] Create verification file @rl4:id=auto-test-003 @rl4:completeWhen="file exists: .test-verification.txt"
- [ ] [P1] Install dependencies @rl4:id=auto-test-004 @rl4:completeWhen="npm install" @rl4:completeWhen="exitCode 0"



# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ§ª TEST TASKS (Automated Testing)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## Test Tasks - DO NOT MODIFY (Used by automated tests)

- [ ] [P0] Run test suite @rl4:id=auto-test-001 @rl4:completeWhen="exitCode 0"
- [ ] [P0] Build project successfully @rl4:id=auto-test-002 @rl4:completeWhen="build success"
- [ ] [P0] Create verification file @rl4:id=auto-test-003 @rl4:completeWhen="file exists: .test-verification.txt"
- [ ] [P1] Install dependencies @rl4:id=auto-test-004 @rl4:completeWhen="npm install" @rl4:completeWhen="exitCode 0"


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ¯ SPRINT P0-CORE: Production Kernel
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Started: 2025-11-17T19:45:00.000Z
# Goal: Rendre le kernel RL4 production-ready (diagnostic + repair cognitive loop + observability)
# Estimated: 12-14h total
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## P0-CORE-00 â€” Fix Cognitive Loop Inertia ğŸ”´ CRITICAL

- [ ] [P0] Diagnose why PatternLearningEngine.analyzePatterns() returns [] @rl4:id=P0-CORE-00-patterns
  - Goal: Identify root cause why 721 cycles produced count: 0 for patterns
  - Files: extension/core/base/PatternLearningEngine.ts
  - Status: pending
  - Priority: CRITICAL (bloquant pour toutes autres tÃ¢ches)

- [ ] [P0] Diagnose why CorrelationEngine.analyze() returns [] @rl4:id=P0-CORE-00-correlations
  - Goal: Identify root cause why 721 cycles produced count: 0 for correlations
  - Files: extension/core/base/CorrelationEngine.ts
  - Status: pending
  - Priority: CRITICAL

- [ ] [P0] Diagnose why ForecastEngine.generate() returns [] @rl4:id=P0-CORE-00-forecasts
  - Goal: Identify root cause why 721 cycles produced count: 0 for forecasts
  - Files: extension/core/base/ForecastEngine.ts
  - Status: pending
  - Priority: CRITICAL

- [ ] [P0] Diagnose why ADRGeneratorV2.generateProposals() returns [] @rl4:id=P0-CORE-00-adrs
  - Goal: Identify root cause why 721 cycles produced count: 0 for ADRs
  - Files: extension/core/base/ADRGeneratorV2.ts
  - Status: pending
  - Priority: CRITICAL

- [ ] [P0] Fix cognitive engines to produce non-empty results @rl4:id=P0-CORE-00-fix
  - Goal: After fix, cycles.jsonl shows count > 0 for at least 1 phase, merkleRoot changes between cycles
  - Files: extension/core/base/*, extension/kernel/CognitiveScheduler.ts
  - Status: pending
  - Priority: CRITICAL
  - Estimated: 2-4h (depends on root cause complexity)

## P0-CORE-01 â€” Kernel Artifact Engine ğŸŸ¡ P1

- [ ] [P1] Create ArtifactWriter.ts with writeAtomic() method @rl4:id=P0-CORE-01-writer
  - Goal: Implement atomic write for state.json.gz with checksum verification
  - Files: extension/kernel/api/ArtifactWriter.ts (NEW)
  - Status: pending
  - Estimated: 1h

- [ ] [P1] Create ArtifactLoader.ts with loadWithRetry() method @rl4:id=P0-CORE-01-loader
  - Goal: Implement retry logic (3x exponential backoff) for artifact loading
  - Files: extension/kernel/api/ArtifactLoader.ts (NEW)
  - Status: pending
  - Estimated: 30min

- [ ] [P1] Integrate artifact generation in CognitiveScheduler @rl4:id=P0-CORE-01-integrate
  - Goal: Call artifactWriter.writeState() in aggregateAndPersistCycle() every 10 cycles
  - Files: extension/kernel/CognitiveScheduler.ts
  - Status: pending
  - Dependencies: P0-CORE-01-writer must be completed
  - Estimated: 30min
  - Success: After 10 cycles, .reasoning_rl4/state.json.gz exists with valid cycle count, merkle root, health metrics

## P0-CORE-02 â€” Kernel Ready Protocol ğŸ”´ HIGH

- [ ] [P0] Create KernelReadyProtocol.ts with init/loadArtifacts/verifyLedger @rl4:id=P0-CORE-02-protocol
  - Goal: Implement initialization sequence with ready flag and waitForKernelReady()
  - Files: extension/kernel/api/KernelReadyProtocol.ts (NEW)
  - Status: pending
  - Estimated: 1h

- [ ] [P0] Integrate protocol in extension.ts activation @rl4:id=P0-CORE-02-activate
  - Goal: Call kernelProtocol.init() before WebView creation, block WebView until ready
  - Files: extension/extension.ts
  - Status: pending
  - Dependencies: P0-CORE-02-protocol must be completed
  - Estimated: 30min
  - Success: Logs show "â³ Kernel initializing..." then "âœ… Kernel ready (X.Xs)", no race conditions

## P0-CORE-03 â€” WebView Bridge v1 ğŸ”´ CRITICAL

- [ ] [P0] Create KernelStatusAPI.ts with getStatus() aggregator @rl4:id=P0-CORE-03-api
  - Goal: Aggregate status from CognitiveScheduler, RBOMLedger, HealthMonitor
  - Files: extension/kernel/api/KernelStatusAPI.ts (NEW)
  - Status: pending
  - Estimated: 45min

- [ ] [P0] Add CognitiveScheduler.getStatus() method @rl4:id=P0-CORE-03-scheduler
  - Goal: Expose cycleCount, isRunning, lastCycleTime, lastInputHash
  - Files: extension/kernel/CognitiveScheduler.ts
  - Status: pending
  - Estimated: 15min

- [ ] [P0] Implement rl4:getStatus handler in extension.ts @rl4:id=P0-CORE-03-handler
  - Goal: WebView sends rl4:getStatus â†’ backend calls KernelStatusAPI.getStatus() â†’ returns JSON to WebView
  - Files: extension/extension.ts
  - Status: pending
  - Dependencies: P0-CORE-03-api, P0-CORE-03-scheduler must be completed
  - Estimated: 30min

- [ ] [P0] Add Kernel Status section in WebView Control Tab @rl4:id=P0-CORE-03-ui
  - Goal: Display cycle count, SAFE MODE status, last cycle timestamp
  - Files: extension/webview/ui/src/App.tsx
  - Status: pending
  - Dependencies: P0-CORE-03-handler must be completed
  - Estimated: 30min
  - Success: Execute window.postMessage({ command: "rl4:getStatus" }) â†’ JSON response visible in console, UI displays kernel status

## P0-CORE-04 â€” Cognitive Loop Full Mode (Identical to CORE-00)

- [ ] [P0] Enable PatternLearningEngine real output @rl4:id=P0-CORE-04-patterns
  - Goal: Same as P0-CORE-00-patterns (duplicate for clarity)
  - Files: extension/core/base/PatternLearningEngine.ts
  - Status: pending
  - Note: This task is the SAME as P0-CORE-00. Fix CORE-00 first.

- [ ] [P0] Enable CorrelationEngine real output @rl4:id=P0-CORE-04-correlations
  - Goal: Same as P0-CORE-00-correlations
  - Files: extension/core/base/CorrelationEngine.ts
  - Status: pending

- [ ] [P0] Enable ForecastEngine real output @rl4:id=P0-CORE-04-forecasts
  - Goal: Same as P0-CORE-00-forecasts
  - Files: extension/core/base/ForecastEngine.ts
  - Status: pending

- [ ] [P0] Enable ADRGeneratorV2 real output @rl4:id=P0-CORE-04-adrs
  - Goal: Same as P0-CORE-00-adrs
  - Files: extension/core/base/ADRGeneratorV2.ts
  - Status: pending

## P0-CORE-05 â€” Production Scheduler ğŸŸ¡ P1

- [ ] [P1] Implement adaptive interval logic @rl4:id=P0-CORE-05-adaptive
  - Goal: Replace fixed interval with adaptive (10s â†’ 15s â†’ 2min â†’ 10min based on activity)
  - Files: extension/kernel/CognitiveScheduler.ts
  - Status: pending
  - Estimated: 1h

- [ ] [P1] Implement burst mode for major events @rl4:id=P0-CORE-05-burst
  - Goal: Trigger immediate cycle on git commit, file save (configurable)
  - Files: extension/kernel/CognitiveScheduler.ts
  - Status: pending
  - Estimated: 30min

- [ ] [P1] Implement cooldown mode for high memory @rl4:id=P0-CORE-05-cooldown
  - Goal: If HealthMonitor reports memory > 450 MB, increase interval to 4h
  - Files: extension/kernel/CognitiveScheduler.ts, extension/kernel/HealthMonitor.ts
  - Status: pending
  - Estimated: 30min
  - Success: Logs show "âš¡ Burst mode triggered" on commit, "ğŸ§Š Cooldown mode: memory high" when > 450 MB

## P0-CORE-06 â€” Kernel Sovereignty Mode ğŸŸ¡ P1

- [ ] [P1] Add kernel.ready validation in WebView message handlers @rl4:id=P0-CORE-06-validation
  - Goal: All handlers check kernel.ready before processing, emit kernel:not-ready if false
  - Files: extension/extension.ts
  - Status: pending
  - Estimated: 30min

- [ ] [P1] Implement kernel:not-ready message to WebView @rl4:id=P0-CORE-06-message
  - Goal: Send { type: 'kernel:not-ready', reason: '...' } when handlers called too early
  - Files: extension/extension.ts
  - Status: pending
  - Estimated: 15min

- [ ] [P1] Add "Kernel initializing..." screen in WebView @rl4:id=P0-CORE-06-ui
  - Goal: Display loading screen when kernel:not-ready received, hide when kernel:ready
  - Files: extension/webview/ui/src/App.tsx
  - Status: pending
  - Estimated: 45min
  - Success: Open WebView immediately after activation â†’ shows "â³ Kernel initializing...", then normal UI after 3s

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# END OF P0-CORE SPRINT
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
